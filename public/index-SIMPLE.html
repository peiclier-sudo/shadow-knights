<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Shadow Knights - SIMPLE VERSION</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
    <style>
        * { margin: 0; padding: 0; overflow: hidden; }
        body {
            background: #0a0a0a;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        #game-container { box-shadow: 0 0 50px rgba(0,212,255,0.5); }
        @media (max-width: 900px) and (orientation: portrait) {
            body::before {
                content: "ðŸ“± Tournez en paysage";
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                color: #fff;
                font-size: 24px;
                z-index: 9999;
            }
            #game-container { display: none; }
        }
    </style>
</head>
<body>
    <div id="game-container"></div>
    <script>
        const config = {
            type: Phaser.AUTO,
            width: 1000,
            height: 700,
            parent: 'game-container',
            backgroundColor: '#0f0f1e',
            physics: { default: 'arcade', arcade: { gravity: { y: 0 }}},
            scene: { create, update },
            scale: { mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH }
        };

        let game, player, boss;
        let playerHealth = 100, bossHealth = 500, playerStamina = 100;
        let isDodging = false, canDodge = true, canAttack = true;
        let playerHealthBar, bossHealthBar, staminaBar, playerHealthText, bossHealthText, staminaText;
        let isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        let bossNextAttackTime = 0;
        
        // Mobile controls
        let moveJoy = { active: false, deltaX: 0, deltaY: 0 };
        let aimJoy = { active: false, angle: 0 };
        let projectiles = [];

        function create() {
            // Grille
            const g = this.add.graphics();
            g.lineStyle(1, 0x1a1a2e, 0.3);
            for (let i = 0; i < 1000; i += 50) g.lineBetween(i, 0, i, 700);
            for (let i = 0; i < 700; i += 50) g.lineBetween(0, i, 1000, i);

            // Joueur
            player = this.add.circle(150, 350, 22, 0x00d4ff);
            this.physics.add.existing(player);
            player.body.setCollideWorldBounds(true);
            player.glow = this.add.circle(150, 350, 35, 0x00d4ff, 0.3);

            // Boss
            boss = this.add.container(850, 350);
            boss.add([
                this.add.rectangle(0, 0, 70, 100, 0xff0051),
                this.add.circle(0, -60, 30, 0xff0051)
            ]);
            this.physics.add.existing(boss);
            boss.body.setSize(70, 130);
            boss.body.setCollideWorldBounds(true);
            boss.body.immovable = true;

            // UI
            this.add.text(20, 20, 'VOUS', { fontSize: '18px', fill: '#00d4ff', fontStyle: 'bold' });
            playerHealthBar = this.add.rectangle(20, 55, 350, 25, 0x1a1a2e).setOrigin(0, 0.5).setStrokeStyle(3, 0x333355);
            playerHealthText = this.add.rectangle(20, 55, 350, 25, 0x00ff88).setOrigin(0, 0.5);
            
            this.add.text(20, 82, 'STAMINA', { fontSize: '14px', fill: '#ffaa00' });
            staminaBar = this.add.rectangle(20, 105, 250, 16, 0x1a1a2e).setOrigin(0, 0.5).setStrokeStyle(2, 0x333355);
            staminaText = this.add.rectangle(20, 105, 250, 16, 0xffaa00).setOrigin(0, 0.5);

            this.add.text(650, 20, 'BOSS', { fontSize: '20px', fill: '#ff0051', fontStyle: 'bold' });
            bossHealthBar = this.add.rectangle(650, 60, 330, 28, 0x1a1a2e).setOrigin(0, 0.5).setStrokeStyle(3, 0x333355);
            bossHealthText = this.add.rectangle(650, 60, 330, 28, 0xff0051).setOrigin(0, 0.5);

            if (isMobile) createMobileControls(this);

            const instructions = isMobile ? 'Gauche: Bouger | Droite: Tirer | Shift: Dash' 
                : 'ZQSD: Bouger | Clic droit: Tirer | SHIFT: Dash';
            this.add.text(500, 680, instructions, { fontSize: '13px', fill: '#aaa', backgroundColor: '#00000099', padding: { x: 15, y: 8 }}).setOrigin(0.5);
        }

        function createMobileControls(scene) {
            // Zones
            const leftZone = scene.add.rectangle(250, 350, 500, 700, 0x0066ff, 0.1);
            const rightZone = scene.add.rectangle(750, 350, 500, 700, 0xff6666, 0.1);
            scene.add.text(250, 50, 'â¬…ï¸ BOUGER', { fontSize: '18px', fill: '#00d4ff', fontStyle: 'bold' }).setOrigin(0.5);
            scene.add.text(750, 50, 'TIRER âž¡ï¸', { fontSize: '18px', fill: '#ff6666', fontStyle: 'bold' }).setOrigin(0.5);
            
            let leftTouch = null, rightTouch = null;
            
            scene.input.addPointer(3);
            
            scene.input.on('pointerdown', (pointer) => {
                if (pointer.x < 500 && !leftTouch) {
                    leftTouch = {
                        id: pointer.id,
                        startX: pointer.x,
                        startY: pointer.y,
                        base: scene.add.circle(pointer.x, pointer.y, 55, 0x0033aa, 0.7).setDepth(300),
                        thumb: scene.add.circle(pointer.x, pointer.y, 28, 0x00d4ff, 1).setDepth(301)
                    };
                }
                
                if (pointer.x >= 500 && !rightTouch) {
                    rightTouch = {
                        id: pointer.id,
                        startX: pointer.x,
                        startY: pointer.y,
                        base: scene.add.circle(pointer.x, pointer.y, 55, 0xaa3300, 0.7).setDepth(300),
                        thumb: scene.add.circle(pointer.x, pointer.y, 28, 0xff6666, 1).setDepth(301)
                    };
                }
            });
            
            scene.input.on('pointermove', (pointer) => {
                if (!pointer.isDown) return;
                
                if (leftTouch && pointer.id === leftTouch.id) {
                    const dx = pointer.x - leftTouch.startX;
                    const dy = pointer.y - leftTouch.startY;
                    const dist = Math.sqrt(dx*dx + dy*dy);
                    const max = 55;
                    
                    if (dist < max) {
                        leftTouch.thumb.x = leftTouch.startX + dx;
                        leftTouch.thumb.y = leftTouch.startY + dy;
                        moveJoy.deltaX = dx / max;
                        moveJoy.deltaY = dy / max;
                    } else {
                        const angle = Math.atan2(dy, dx);
                        leftTouch.thumb.x = leftTouch.startX + Math.cos(angle) * max;
                        leftTouch.thumb.y = leftTouch.startY + Math.sin(angle) * max;
                        moveJoy.deltaX = Math.cos(angle);
                        moveJoy.deltaY = Math.sin(angle);
                    }
                    moveJoy.active = true;
                }
                
                if (rightTouch && pointer.id === rightTouch.id) {
                    const dx = pointer.x - rightTouch.startX;
                    const dy = pointer.y - rightTouch.startY;
                    const dist = Math.sqrt(dx*dx + dy*dy);
                    const max = 55;
                    
                    if (dist < max) {
                        rightTouch.thumb.x = rightTouch.startX + dx;
                        rightTouch.thumb.y = rightTouch.startY + dy;
                    } else {
                        const angle = Math.atan2(dy, dx);
                        rightTouch.thumb.x = rightTouch.startX + Math.cos(angle) * max;
                        rightTouch.thumb.y = rightTouch.startY + Math.sin(angle) * max;
                    }
                    
                    aimJoy.angle = Math.atan2(dy, dx);
                    aimJoy.active = dist > 15;
                }
            });
            
            scene.input.on('pointerup', (pointer) => {
                if (leftTouch && pointer.id === leftTouch.id) {
                    leftTouch.base.destroy();
                    leftTouch.thumb.destroy();
                    leftTouch = null;
                    moveJoy.active = false;
                    moveJoy.deltaX = 0;
                    moveJoy.deltaY = 0;
                }
                
                if (rightTouch && pointer.id === rightTouch.id) {
                    if (aimJoy.active && canAttack && playerStamina >= 20) {
                        shootProjectile(scene, aimJoy.angle);
                    }
                    rightTouch.base.destroy();
                    rightTouch.thumb.destroy();
                    rightTouch = null;
                    aimJoy.active = false;
                }
            });
        }

        function update(time, delta) {
            if (playerHealth <= 0 || bossHealth <= 0) {
                handleGameOver(this);
                return;
            }

            // Mouvement
            const speed = 220;
            let vx = 0, vy = 0;
            
            if (moveJoy.active) {
                vx = moveJoy.deltaX * speed;
                vy = moveJoy.deltaY * speed;
            }
            
            player.body.setVelocity(vx, vy);
            player.glow.x = player.x;
            player.glow.y = player.y;

            // Update projectiles MANUELLEMENT
            for (let i = projectiles.length - 1; i >= 0; i--) {
                const proj = projectiles[i];
                
                // Bouger le projectile
                proj.x += proj.vx * (delta / 1000);
                proj.y += proj.vy * (delta / 1000);
                
                // Collision avec boss
                const dist = Phaser.Math.Distance.Between(proj.x, proj.y, boss.x, boss.y);
                if (dist < 60) {
                    hitBoss(this, 18);
                    proj.destroy();
                    projectiles.splice(i, 1);
                    continue;
                }
                
                // Hors Ã©cran
                if (proj.x < -50 || proj.x > 1050 || proj.y < -50 || proj.y > 750) {
                    proj.destroy();
                    projectiles.splice(i, 1);
                }
            }

            // Regen stamina
            if (playerStamina < 100) {
                playerStamina = Math.min(100, playerStamina + 0.4);
                updateStaminaBar();
            }

            // Boss AI simple
            if (time > bossNextAttackTime) {
                bossNextAttackTime = time + Phaser.Math.Between(3000, 5000);
                bossAttack(this);
            }

            updateHealthBars();
        }

        function shootProjectile(scene, angle) {
            canAttack = false;
            playerStamina -= 20;
            
            const speed = 600;
            const proj = scene.add.circle(
                player.x + Math.cos(angle) * 30,
                player.y + Math.sin(angle) * 30,
                10,
                0x66ffff
            );
            proj.setDepth(150);
            
            // Stocker la vÃ©locitÃ©
            proj.vx = Math.cos(angle) * speed;
            proj.vy = Math.sin(angle) * speed;
            
            projectiles.push(proj);
            
            console.log('ðŸ”« SHOT:', proj.vx.toFixed(0), proj.vy.toFixed(0));
            
            // Trail
            scene.time.addEvent({
                delay: 50,
                repeat: 40,
                callback: () => {
                    if (!proj.scene) return;
                    const trail = scene.add.circle(proj.x, proj.y, 6, 0x66ffff, 0.5);
                    scene.tweens.add({
                        targets: trail,
                        alpha: 0,
                        scale: 0.3,
                        duration: 400,
                        onComplete: () => trail.destroy()
                    });
                }
            });
            
            scene.time.delayedCall(500, () => canAttack = true);
        }

        function bossAttack(scene) {
            // Slash simple
            const warning = scene.add.rectangle(boss.x - 100, boss.y, 150, 130, 0xff0051, 0.2);
            warning.setStrokeStyle(3, 0xff0051);
            
            scene.tweens.add({
                targets: warning,
                alpha: 0.5,
                duration: 800,
                yoyo: true,
                onComplete: () => {
                    warning.destroy();
                    
                    const slashZone = scene.add.rectangle(boss.x - 100, boss.y, 150, 130, 0xff6666, 0.7);
                    scene.physics.add.existing(slashZone);
                    
                    const dist = Phaser.Math.Distance.Between(player.x, player.y, boss.x, boss.y);
                    if (dist < 120 && !isDodging) {
                        hitPlayer(scene, 15);
                    }
                    
                    scene.tweens.add({
                        targets: slashZone,
                        alpha: 0,
                        duration: 200,
                        onComplete: () => slashZone.destroy()
                    });
                }
            });
        }

        function hitBoss(scene, damage) {
            bossHealth = Math.max(0, bossHealth - damage);
            scene.tweens.add({ targets: boss, alpha: 0.5, duration: 80, yoyo: true });
            
            // Particles
            for (let i = 0; i < 10; i++) {
                const p = scene.add.circle(boss.x, boss.y, 5, 0xff0051);
                const angle = (Math.PI * 2 * i) / 10;
                scene.tweens.add({
                    targets: p,
                    x: boss.x + Math.cos(angle) * 50,
                    y: boss.y + Math.sin(angle) * 50,
                    alpha: 0,
                    duration: 500,
                    onComplete: () => p.destroy()
                });
            }
        }

        function hitPlayer(scene, damage) {
            playerHealth = Math.max(0, playerHealth - damage);
            scene.tweens.add({ targets: player, alpha: 0.3, duration: 100, yoyo: true });
        }

        function updateHealthBars() {
            playerHealthText.width = 350 * (playerHealth / 100);
            bossHealthText.width = 330 * (bossHealth / 500);
            
            if (playerHealth < 30) playerHealthText.fillColor = 0xff0000;
            else if (playerHealth < 60) playerHealthText.fillColor = 0xffaa00;
            else playerHealthText.fillColor = 0x00ff88;
        }

        function updateStaminaBar() {
            staminaText.width = 250 * (playerStamina / 100);
        }

        function handleGameOver(scene) {
            scene.physics.pause();
            const isVictory = bossHealth <= 0;
            const msg = isVictory ? 'âœ¨ VICTOIRE âœ¨' : 'ðŸ’€ DÃ‰FAITE ðŸ’€';
            const color = isVictory ? '#00ff88' : '#ff3355';
            
            const txt = scene.add.text(500, 300, msg, { 
                fontSize: '64px', 
                fill: color, 
                fontStyle: 'bold', 
                stroke: '#000', 
                strokeThickness: 6 
            }).setOrigin(0.5);
            
            scene.tweens.add({ targets: txt, scale: 1.15, duration: 600, yoyo: true, repeat: -1 });
            
            const restart = scene.add.text(500, 400, 'Cliquer pour recommencer', { 
                fontSize: '20px', 
                fill: '#fff', 
                backgroundColor: '#00000099', 
                padding: { x: 20, y: 10 }
            }).setOrigin(0.5);
            
            scene.input.once('pointerdown', () => {
                scene.scene.restart();
                playerHealth = 100;
                bossHealth = 500;
                playerStamina = 100;
                projectiles = [];
            });
        }

        window.addEventListener('load', () => { game = new Phaser.Game(config); });
    </script>
</body>
</html>
